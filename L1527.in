#!/usr/bin/env python
# -*- coding: utf-8 -*-
import numpy as np
import cst
import mytools

# General
debug = 1
object_name = "L1527"
dpc = 137
Tenv = 10

# Physical Model
model = mytools.Parameters()
model.plot = 1
model.ire_model = {1:"CM", 2:"Simple"}[2]
model.submodel = {0:None, 1:"CM", 2:"Simple"}[0]
# model.norot = 1
model.disk = 0
model.r_in = 1 * cst.au
model.r_out = 1e4 * cst.au
model.nr = 601
model.theta_in = 0 #1e-6
model.theta_out = np.pi/2
model.ntheta = mytools.get_square_ntheta([model.r_in, model.r_out], model.nr)
model.phi_in = -np.pi
model.phi_out = +np.pi
model.nphi = 1
model.Tenv = Tenv
model.r_CR = 200 * cst.au
model.Mstar = 0.18 * cst.Msun
model.t = None
model.Omega = None
model.j0 = None
model.Tdisk = 70
model.disk_star_fraction = 0.1
model.cavity_angle = 0 # degree from z-axis, disk_angle = 2*(90-cavity_angle)
model.simple_density = 0 # True
model.counterclockwise_rotation = False
model.fn_model_pkl = "model_L1527.pkl"

# radmc parameters
radmc = mytools.Parameters()
radmc.plot = 1
radmc.nphot = 1000000
radmc.r_in = 100 * cst.au
radmc.r_out = 1e3 * cst.au
radmc.nr = 256 #256 #256 #128 # 128 #1024 #128
# dr(100au) ~ 100au * dlogr * 2.3 = 230 * 1/nr au
# dr(500au) ~ 1000au * dlogr * 2.3 = 2300 * 1/nr au
radmc.theta_in = 0
radmc.theta_out = np.pi/2
radmc.ntheta = mytools.get_square_ntheta([radmc.r_in, radmc.r_out], radmc.nr)
radmc.phi_in = -np.pi
radmc.phi_out = np.pi
radmc.nphi = 1
radmc.Lstar = 2.75 * cst.Lsun
radmc.Rstar = 1 * cst.Rsun
radmc.fdg = 0.0  # 0.01
radmc.mol_abun = 1e-17
radmc.mol_name = {1:"c18o", 2:"cch", 3:"c18omod"}[1]  # c18o or cch
radmc.m_mol = {"c18o":28, "cch":25}[radmc.mol_name] * cst.amu
iline = {"c18o":1, "cch":28}[radmc.mol_name]
#radmc.v_fwhm = 0.04 * cst.kms  # or give Tenv
radmc.Tenv = Tenv
radmc.temp_mode = {1:"const", 2:"mctherm"}[2]
radmc.line = True
radmc.turb = False
radmc.lowreso = False
radmc.subgrid = True
radmc.autoset = True
radmc.fn_model_pkl = model.fn_model_pkl
radmc.fn_radmcset_pkl = 'set_radmc.pkl'

sobs = mytools.Parameters()
#sobs.ovserve = 1 # True
sobs.filename = "sobs"
sobs.dpc = dpc
sobs.iline = iline  # 1 # see table
sobs.sizex_au = 16 * sobs.dpc
sobs.sizey_au = 16 * sobs.dpc
sobs.pixsize_au = 0.1 * sobs.dpc # 11au
sobs.vwidth_kms = 3  # 5.12
sobs.dv_kms = 0.1  # 0.04
sobs.incl = 85  # angle between direction to us , 0: face-on
sobs.phi = 0
sobs.posang = 95  # angle between y-axis, ccw is positive
sobs.rect_camera = True
sobs.omp = True
sobs.n_thread = 16

fitsa = mytools.Parameters()
fitsa.filename = {1:"sobs",2:"Flare20_PV"}[2] # sobs.filename
fitsa.dpc = dpc
fitsa.posang_PV = sobs.posang
fitsa.convolution_pvdiagram = 1 #1  #True
fitsa.convolution_mom0map = 0  #True
fitsa.convolver = {1:"normal", 2:"fft"}[2]
fitsa.logcolor_PV = 0
fitsa.oplot_KeplerRotation = 0
fitsa.oplot_LocalPeak_Vax = 0
fitsa.oplot_LocalPeak_Pax = 0
fitsa.oplot_LocalPeak_2D = 0
fitsa.oplot_Maximums_2D = 0
fitsa.normalize = {1:None, 2:"peak"}[2]
fitsa.Imax = 2e-4 * (radmc.mol_abun/1e-7)
fitsa.Mstar = 0.18
beam_scale = 1e-10
fitsa.beama_au = 0.4 * fitsa.dpc * beam_scale
fitsa.beamb_au = 0.9 * fitsa.dpc * beam_scale
fitsa.beam_posang = -41
fitsa.vwidth_kms = 0.5 * beam_scale
fitsa.plotmode_PV = {1:"grid", 2:"contour", 3:"contourf", 4:"contourfill"}[2]
fitsa.convolve_PV_p = True
fitsa.convolve_PV_v = 1 # True  #
fitsa.pointsource_test = False
fitsa.mass_estimation = 0
